<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rozpočtová kalkulace - ASV Solnice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3a72 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            padding: 30px;
        }
        
        .budget-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 25px;
        }
        
        .preview-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 25px;
        }
        
        .section-title {
            color: #2c5aa0;
            font-size: 1.5em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2c5aa0;
        }
        
        .item-group {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }
        
        .item-group h3 {
            color: #2c5aa0;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .budget-header {
            display: grid;
            grid-template-columns: 2.5fr 0.8fr 0.8fr 1.2fr 0.8fr 1.2fr;
            gap: 10px;
            align-items: center;
            padding: 12px 8px;
            font-weight: bold;
            color: white;
            background: #2c5aa0;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        
        .budget-item {
            display: grid;
            grid-template-columns: 2.5fr 0.8fr 0.8fr 1.2fr 0.8fr 1.2fr;
            gap: 10px;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .budget-item:last-child {
            border-bottom: none;
        }
        
        .budget-item:hover {
            background: #f8f9fa;
        }
        
        .item-label {
            font-weight: 500;
            font-size: 0.9em;
        }
        
        .input-field {
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            width: 100%;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
        }
        
        .final-price {
            font-weight: bold;
            color: #2c5aa0;
            font-size: 14px;
            text-align: right;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .btn {
            background: #2c5aa0;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin: 0 8px;
            transition: background 0.2s;
        }
        
        .btn:hover {
            background: #1e3a72;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .stat-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c5aa0;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .preview-table th {
            background: #2c5aa0;
            color: white;
            padding: 10px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .preview-table td {
            padding: 8px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9em;
        }
        
        .preview-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .total-row {
            background: #2c5aa0 !important;
            color: white;
            font-weight: bold;
        }
        
        .price-cell {
            text-align: right;
            font-weight: bold;
            color: #2c5aa0;
        }
        
        .total-row .price-cell {
            color: white;
        }
        
        @media (max-width: 1400px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .budget-header, .budget-item {
                grid-template-columns: 1fr;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Rozpočtová kalkulace FVE</h1>
            <p>ASV Solnice - Profesionální rozpočtování s množstvími a jednotkami</p>
        </div>

        <div class="content">
            <!-- ROZPOČET -->
            <div class="budget-section">
                <h2 class="section-title">📋 Rozpočtová kalkulace</h2>
                
                <!-- SolarEdge komponenty -->
                <div class="item-group">
                    <h3>🔌 SolarEdge komponenty</h3>
                    
                    <div class="budget-header">
                        <div>Položka</div>
                        <div>Množství</div>
                        <div>Jednotka</div>
                        <div>Jedn. cena</div>
                        <div>Marže %</div>
                        <div>Celkem</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">SE50K MC4 střídač</div>
                        <input type="number" class="input-field" id="se50k_qty" value="1" autocomplete="off">
                        <select class="input-field" id="se50k_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                        </select>
                        <input type="number" class="input-field" id="se50k_price" value="60934" autocomplete="off">
                        <input type="number" class="input-field" id="se50k_margin" value="10" autocomplete="off">
                        <div class="final-price" id="se50k_total">67 027</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">SE25K-M4 střídač</div>
                        <input type="number" class="input-field" id="se25k_qty" value="1" autocomplete="off">
                        <select class="input-field" id="se25k_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                        </select>
                        <input type="number" class="input-field" id="se25k_price" value="31838" autocomplete="off">
                        <input type="number" class="input-field" id="se25k_margin" value="10" autocomplete="off">
                        <div class="final-price" id="se25k_total">35 022</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">S1000 optimizéry</div>
                        <input type="number" class="input-field" id="optimizers_qty" value="110" autocomplete="off">
                        <select class="input-field" id="optimizers_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                        </select>
                        <input type="number" class="input-field" id="optimizers_price" value="1107" autocomplete="off">
                        <input type="number" class="input-field" id="optimizers_margin" value="10" autocomplete="off">
                        <div class="final-price" id="optimizers_total">133 898</div>
                    </div>
                </div>

                <!-- Montážní práce -->
                <div class="item-group">
                    <h3>🔧 Montážní práce</h3>
                    
                    <div class="budget-header">
                        <div>Položka</div>
                        <div>Množství</div>
                        <div>Jednotka</div>
                        <div>Jedn. cena</div>
                        <div>Marže %</div>
                        <div>Celkem</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">Montáž FV panelů</div>
                        <input type="number" class="input-field" id="panel_mount_qty" value="217" autocomplete="off">
                        <select class="input-field" id="panel_mount_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                            <option value="hod">hod</option>
                        </select>
                        <input type="number" class="input-field" id="panel_mount_price" value="276" autocomplete="off">
                        <input type="number" class="input-field" id="panel_mount_margin" value="50" autocomplete="off">
                        <div class="final-price" id="panel_mount_total">90 000</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">Montáž střídačů</div>
                        <input type="number" class="input-field" id="inverter_mount_qty" value="2" autocomplete="off">
                        <select class="input-field" id="inverter_mount_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                            <option value="hod">hod</option>
                        </select>
                        <input type="number" class="input-field" id="inverter_mount_price" value="4000" autocomplete="off">
                        <input type="number" class="input-field" id="inverter_mount_margin" value="25" autocomplete="off">
                        <div class="final-price" id="inverter_mount_total">10 000</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">Montáž optimizérů</div>
                        <input type="number" class="input-field" id="optimizer_mount_qty" value="110" autocomplete="off">
                        <select class="input-field" id="optimizer_mount_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                            <option value="hod">hod</option>
                        </select>
                        <input type="number" class="input-field" id="optimizer_mount_price" value="73" autocomplete="off">
                        <input type="number" class="input-field" id="optimizer_mount_margin" value="67" autocomplete="off">
                        <div class="final-price" id="optimizer_mount_total">13 360</div>
                    </div>
                </div>

                <!-- K2 konstrukce -->
                <div class="item-group">
                    <h3>🏗️ Nosná konstrukce K2</h3>
                    
                    <div class="budget-header">
                        <div>Položka</div>
                        <div>Množství</div>
                        <div>Jednotka</div>
                        <div>Jedn. cena</div>
                        <div>Marže %</div>
                        <div>Celkem</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">K2 MultiRail komponenty</div>
                        <input type="number" class="input-field" id="k2_components_qty" value="1" autocomplete="off">
                        <select class="input-field" id="k2_components_unit" autocomplete="off">
                            <option value="soubor">soubor</option>
                            <option value="kg">kg</option>
                        </select>
                        <input type="number" class="input-field" id="k2_components_price" value="70333" autocomplete="off">
                        <input type="number" class="input-field" id="k2_components_margin" value="31" autocomplete="off">
                        <div class="final-price" id="k2_components_total">92 136</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">Montáž K2 konstrukce</div>
                        <input type="number" class="input-field" id="k2_mount_qty" value="217" autocomplete="off">
                        <select class="input-field" id="k2_mount_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                            <option value="hod">hod</option>
                        </select>
                        <input type="number" class="input-field" id="k2_mount_price" value="230" autocomplete="off">
                        <input type="number" class="input-field" id="k2_mount_margin" value="46" autocomplete="off">
                        <div class="final-price" id="k2_mount_total">73 000</div>
                    </div>
                </div>

                <!-- Rozvaděče -->
                <div class="item-group">
                    <h3>📦 Rozvaděče a combiner boxy</h3>
                    
                    <div class="budget-header">
                        <div>Položka</div>
                        <div>Množství</div>
                        <div>Jednotka</div>
                        <div>Jedn. cena</div>
                        <div>Marže %</div>
                        <div>Celkem</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">DC rozvaděč INVRDC1 (u SE50K)</div>
                        <input type="number" class="input-field" id="invrdc1_qty" value="1" autocomplete="off">
                        <select class="input-field" id="invrdc1_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                        </select>
                        <input type="number" class="input-field" id="invrdc1_price" value="8000" autocomplete="off">
                        <input type="number" class="input-field" id="invrdc1_margin" value="50" autocomplete="off">
                        <div class="final-price" id="invrdc1_total">12 000</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">DC rozvaděč INVRDC2 (u SE25K)</div>
                        <input type="number" class="input-field" id="invrdc2_qty" value="1" autocomplete="off">
                        <select class="input-field" id="invrdc2_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                        </select>
                        <input type="number" class="input-field" id="invrdc2_price" value="6000" autocomplete="off">
                        <input type="number" class="input-field" id="invrdc2_margin" value="50" autocomplete="off">
                        <div class="final-price" id="invrdc2_total">9 000</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">DC rozvaděče RDC u řetězců</div>
                        <input type="number" class="input-field" id="rdc_qty" value="3" autocomplete="off">
                        <select class="input-field" id="rdc_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                        </select>
                        <input type="number" class="input-field" id="rdc_price" value="3500" autocomplete="off">
                        <input type="number" class="input-field" id="rdc_margin" value="50" autocomplete="off">
                        <div class="final-price" id="rdc_total">15 750</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">AC rozvaděč RFVE1 pro SE50K</div>
                        <input type="number" class="input-field" id="rfve1_qty" value="1" autocomplete="off">
                        <select class="input-field" id="rfve1_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                        </select>
                        <input type="number" class="input-field" id="rfve1_price" value="15000" autocomplete="off">
                        <input type="number" class="input-field" id="rfve1_margin" value="40" autocomplete="off">
                        <div class="final-price" id="rfve1_total">21 000</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">AC rozvaděč RFVE2 pro SE25K</div>
                        <input type="number" class="input-field" id="rfve2_qty" value="1" autocomplete="off">
                        <select class="input-field" id="rfve2_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                        </select>
                        <input type="number" class="input-field" id="rfve2_price" value="10000" autocomplete="off">
                        <input type="number" class="input-field" id="rfve2_margin" value="40" autocomplete="off">
                        <div class="final-price" id="rfve2_total">14 000</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">Výzbroj pro RIS1.R1.2 (napojení RFVE1)</div>
                        <input type="number" class="input-field" id="ris1_r12_qty" value="1" autocomplete="off">
                        <select class="input-field" id="ris1_r12_unit" autocomplete="off">
                            <option value="soubor">soubor</option>
                            <option value="ks">ks</option>
                        </select>
                        <input type="number" class="input-field" id="ris1_r12_price" value="12000" autocomplete="off">
                        <input type="number" class="input-field" id="ris1_r12_margin" value="50" autocomplete="off">
                        <div class="final-price" id="ris1_r12_total">18 000</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">Výzbroj pro RIS1.R1.1.2 (napojení RFVE2)</div>
                        <input type="number" class="input-field" id="ris1_r112_qty" value="1" autocomplete="off">
                        <select class="input-field" id="ris1_r112_unit" autocomplete="off">
                            <option value="soubor">soubor</option>
                            <option value="ks">ks</option>
                        </select>
                        <input type="number" class="input-field" id="ris1_r112_price" value="8000" autocomplete="off">
                        <input type="number" class="input-field" id="ris1_r112_margin" value="50" autocomplete="off">
                        <div class="final-price" id="ris1_r112_total">12 000</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">Montáž rozvaděčů a výzbroje</div>
                        <input type="number" class="input-field" id="panels_mount_qty" value="9" autocomplete="off">
                        <select class="input-field" id="panels_mount_unit" autocomplete="off">
                            <option value="ks">ks</option>
                            <option value="soubor">soubor</option>
                            <option value="hod">hod</option>
                        </select>
                        <input type="number" class="input-field" id="panels_mount_price" value="1000" autocomplete="off">
                        <input type="number" class="input-field" id="panels_mount_margin" value="50" autocomplete="off">
                        <div class="final-price" id="panels_mount_total">13 500</div>
                    </div>
                </div>

                <!-- Kabeláž -->
                <div class="item-group">
                    <h3>⚡ Kabeláž a elektroinstalace</h3>
                    
                    <div class="budget-header">
                        <div>Položka</div>
                        <div>Množství</div>
                        <div>Jednotka</div>
                        <div>Jedn. cena</div>
                        <div>Marže %</div>
                        <div>Celkem</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">DC kabel 6mm²</div>
                        <input type="number" class="input-field" id="dc_cable6_qty" value="152" autocomplete="off">
                        <select class="input-field" id="dc_cable6_unit" autocomplete="off">
                            <option value="m">m</option>
                            <option value="soubor">soubor</option>
                            <option value="km">km</option>
                        </select>
                        <input type="number" class="input-field" id="dc_cable6_price" value="85" autocomplete="off">
                        <input type="number" class="input-field" id="dc_cable6_margin" value="50" autocomplete="off">
                        <div class="final-price" id="dc_cable6_total">19 380</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">DC kabel 10mm²</div>
                        <input type="number" class="input-field" id="dc_cable10_qty" value="133" autocomplete="off">
                        <select class="input-field" id="dc_cable10_unit" autocomplete="off">
                            <option value="m">m</option>
                            <option value="soubor">soubor</option>
                            <option value="km">km</option>
                        </select>
                        <input type="number" class="input-field" id="dc_cable10_price" value="120" autocomplete="off">
                        <input type="number" class="input-field" id="dc_cable10_margin" value="50" autocomplete="off">
                        <div class="final-price" id="dc_cable10_total">23 940</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">AC kabelová trasa pro RFVE1</div>
                        <input type="number" class="input-field" id="ac_cables_rfve1_qty" value="1" autocomplete="off">
                        <select class="input-field" id="ac_cables_rfve1_unit" autocomplete="off">
                            <option value="m">m</option>
                            <option value="soubor">soubor</option>
                        </select>
                        <input type="number" class="input-field" id="ac_cables_rfve1_price" value="15000" autocomplete="off">
                        <input type="number" class="input-field" id="ac_cables_rfve1_margin" value="40" autocomplete="off">
                        <div class="final-price" id="ac_cables_rfve1_total">21 000</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">AC kabelová trasa pro RFVE2</div>
                        <input type="number" class="input-field" id="ac_cables_rfve2_qty" value="1" autocomplete="off">
                        <select class="input-field" id="ac_cables_rfve2_unit" autocomplete="off">
                            <option value="m">m</option>
                            <option value="soubor">soubor</option>
                        </select>
                        <input type="number" class="input-field" id="ac_cables_rfve2_price" value="10000" autocomplete="off">
                        <input type="number" class="input-field" id="ac_cables_rfve2_margin" value="40" autocomplete="off">
                        <div class="final-price" id="ac_cables_rfve2_total">14 000</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">Montáž kabelových tras</div>
                        <input type="number" class="input-field" id="electrical_work_qty" value="40" autocomplete="off">
                        <select class="input-field" id="electrical_work_unit" autocomplete="off">
                            <option value="hod">hod</option>
                            <option value="soubor">soubor</option>
                        </select>
                        <input type="number" class="input-field" id="electrical_work_price" value="375" autocomplete="off">
                        <input type="number" class="input-field" id="electrical_work_margin" value="67" autocomplete="off">
                        <div class="final-price" id="electrical_work_total">25 000</div>
                    </div>
                </div>

                <!-- Doprava -->
                <div class="item-group">
                    <h3>🚚 Doprava</h3>
                    
                    <div class="budget-header">
                        <div>Položka</div>
                        <div>Množství</div>
                        <div>Jednotka</div>
                        <div>Jedn. cena</div>
                        <div>Marže %</div>
                        <div>Celkem</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">Doprava na místo realizace</div>
                        <input type="number" class="input-field" id="transport_qty" value="1400" autocomplete="off">
                        <select class="input-field" id="transport_unit" autocomplete="off">
                            <option value="km">km</option>
                            <option value="soubor">soubor</option>
                        </select>
                        <input type="number" class="input-field" id="transport_price" value="12" autocomplete="off">
                        <input type="number" class="input-field" id="transport_margin" value="0" autocomplete="off">
                        <div class="final-price" id="transport_total">16 800</div>
                    </div>
                </div>

                <!-- Servis -->
                <div class="item-group">
                    <h3>🔧 Servis a uvedení do provozu</h3>
                    
                    <div class="budget-header">
                        <div>Položka</div>
                        <div>Množství</div>
                        <div>Jednotka</div>
                        <div>Jedn. cena</div>
                        <div>Marže %</div>
                        <div>Celkem</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">Konfigurace a funkční zkouška</div>
                        <input type="number" class="input-field" id="config_qty" value="1" autocomplete="off">
                        <select class="input-field" id="config_unit" autocomplete="off">
                            <option value="soubor">soubor</option>
                            <option value="hod">hod</option>
                        </select>
                        <input type="number" class="input-field" id="config_price" value="20000" autocomplete="off">
                        <input type="number" class="input-field" id="config_margin" value="75" autocomplete="off">
                        <div class="final-price" id="config_total">35 000</div>
                    </div>
                    
                    <div class="budget-item">
                        <div class="item-label">Dokumentace a školení</div>
                        <input type="number" class="input-field" id="documentation_qty" value="1" autocomplete="off">
                        <select class="input-field" id="documentation_unit" autocomplete="off">
                            <option value="soubor">soubor</option>
                            <option value="hod">hod</option>
                        </select>
                        <input type="number" class="input-field" id="documentation_price" value="6000" autocomplete="off">
                        <input type="number" class="input-field" id="documentation_margin" value="67" autocomplete="off">
                        <div class="final-price" id="documentation_total">10 000</div>
                    </div>
                    
                </div>

                <div class="controls">
                    <button class="btn" onclick="calculateBudget()">🔄 Přepočítat rozpočet</button>
                    <button class="btn btn-secondary" onclick="resetBudget()">↩️ Výchozí hodnoty</button>
                    <button class="btn" onclick="exportBudget()">📝 Export do nabídky</button>
                </div>
            </div>

            <!-- NÁHLED -->
            <div class="preview-section">
                <h2 class="section-title">📊 Shrnutí rozpočtu</h2>
                
                <div class="summary-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="total_items">18</div>
                        <div class="stat-label">Rozpočtových položek</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total_cost">418 061</div>
                        <div class="stat-label">Náklady celkem</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total_margin">265 451</div>
                        <div class="stat-label">Marže celkem</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg_margin">63.5%</div>
                        <div class="stat-label">Průměrná marže</div>
                    </div>
                </div>

                <table class="preview-table">
                    <thead>
                        <tr>
                            <th>Skupina</th>
                            <th>Náklad</th>
                            <th>Marže</th>
                            <th>Celkem</th>
                        </tr>
                    </thead>
                    <tbody id="preview_tbody">
                        <!-- Dynamicky generováno -->
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td><strong>CELKEM bez DPH</strong></td>
                            <td class="price-cell" id="preview_total_cost"><strong>418 061</strong></td>
                            <td class="price-cell" id="preview_total_margin"><strong>265 451</strong></td>
                            <td class="price-cell" id="preview_total_final"><strong>683 512</strong></td>
                        </tr>
                        <tr>
                            <td>DPH 21%</td>
                            <td></td>
                            <td></td>
                            <td class="price-cell" id="preview_vat">143 538</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>CELKEM s DPH</strong></td>
                            <td></td>
                            <td></td>
                            <td class="price-cell" id="preview_total_with_vat"><strong>827 050</strong></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Definice všech rozpočtových položek
        const budgetItems = [
            // SolarEdge komponenty
            {id: 'se50k', group: 'SolarEdge komponenty'},
            {id: 'se25k', group: 'SolarEdge komponenty'},
            {id: 'optimizers', group: 'SolarEdge komponenty'},
            
            // Montážní práce
            {id: 'panel_mount', group: 'Montážní práce'},
            {id: 'inverter_mount', group: 'Montážní práce'},
            {id: 'optimizer_mount', group: 'Montážní práce'},
            
            // K2 konstrukce
            {id: 'k2_components', group: 'Nosná konstrukce K2'},
            {id: 'k2_mount', group: 'Nosná konstrukce K2'},
            
            // Rozvaděče
            {id: 'invrdc1', group: 'Rozvaděče'},
            {id: 'invrdc2', group: 'Rozvaděče'},
            {id: 'rdc', group: 'Rozvaděče'},
            {id: 'rfve1', group: 'Rozvaděče'},
            {id: 'rfve2', group: 'Rozvaděče'},
            {id: 'ris1_r12', group: 'Rozvaděče'},
            {id: 'ris1_r112', group: 'Rozvaděče'},
            {id: 'panels_mount', group: 'Rozvaděče'},
            
            // Kabeláž
            {id: 'dc_cable6', group: 'Kabeláž a elektroinstalace'},
            {id: 'dc_cable10', group: 'Kabeláž a elektroinstalace'},
            {id: 'ac_cables_rfve1', group: 'Kabeláž a elektroinstalace'},
            {id: 'ac_cables_rfve2', group: 'Kabeláž a elektroinstalace'},
            {id: 'electrical_work', group: 'Kabeláž a elektroinstalace'},
            
            // Doprava
            {id: 'transport', group: 'Doprava'},
            
            // Servis
            {id: 'config', group: 'Servis'},
            {id: 'documentation', group: 'Servis'}
        ];

        function formatNumber(num) {
            return Math.round(num).toLocaleString('cs-CZ');
        }

        function calculateBudget() {
            let totalCost = 0;
            let totalFinal = 0;
            const groupTotals = {};

            budgetItems.forEach(item => {
                const qty = parseFloat(document.getElementById(item.id + '_qty').value) || 0;
                const price = parseFloat(document.getElementById(item.id + '_price').value) || 0;
                const margin = parseFloat(document.getElementById(item.id + '_margin').value) || 0;
                
                const itemCost = qty * price;
                const itemFinal = itemCost * (1 + margin / 100);
                
                // Aktualizace zobrazení
                document.getElementById(item.id + '_total').textContent = formatNumber(itemFinal);
                
                // Přidání do celkových součtů
                totalCost += itemCost;
                totalFinal += itemFinal;
                
                // Přidání do skupinových součtů
                if (!groupTotals[item.group]) {
                    groupTotals[item.group] = { cost: 0, final: 0 };
                }
                groupTotals[item.group].cost += itemCost;
                groupTotals[item.group].final += itemFinal;
            });

            // Aktualizace summary statistik
            const totalMargin = totalFinal - totalCost;
            const marginPercent = totalCost > 0 ? (totalMargin / totalCost * 100) : 0;
            
            document.getElementById('total_items').textContent = budgetItems.length;
            document.getElementById('total_cost').textContent = formatNumber(totalCost);
            document.getElementById('total_margin').textContent = formatNumber(totalMargin);
            document.getElementById('avg_margin').textContent = marginPercent.toFixed(1) + '%';

            // Aktualizace náhledu podle skupin
            let previewRows = '';
            Object.keys(groupTotals).forEach(groupName => {
                const group = groupTotals[groupName];
                const groupMargin = group.final - group.cost;
                previewRows += `
                    <tr>
                        <td>${groupName}</td>
                        <td class="price-cell">${formatNumber(group.cost)}</td>
                        <td class="price-cell">${formatNumber(groupMargin)}</td>
                        <td class="price-cell">${formatNumber(group.final)}</td>
                    </tr>
                `;
            });

            document.getElementById('preview_tbody').innerHTML = previewRows;
            document.getElementById('preview_total_cost').innerHTML = '<strong>' + formatNumber(totalCost) + '</strong>';
            document.getElementById('preview_total_margin').innerHTML = '<strong>' + formatNumber(totalMargin) + '</strong>';
            document.getElementById('preview_total_final').innerHTML = '<strong>' + formatNumber(totalFinal) + '</strong>';
            
            // DPH a celkem s DPH
            const vat = totalFinal * 0.21;
            const totalWithVat = totalFinal + vat;
            document.getElementById('preview_vat').textContent = formatNumber(vat);
            document.getElementById('preview_total_with_vat').innerHTML = '<strong>' + formatNumber(totalWithVat) + '</strong>';
        }

        function resetBudget() {
            // Vymazat uložený stav
            localStorage.removeItem('budgetState');
            // Reset všech hodnot na výchozí
            location.reload();
        }

        function exportBudget() {
            calculateBudget();
            
            // Shromáždit data pro export
            const exportData = {
                items: {},
                totals: {
                    withoutVat: 0,
                    vat: 0,
                    withVat: 0
                }
            };
            
            let totalFinal = 0;
            budgetItems.forEach(item => {
                const qty = parseFloat(document.getElementById(item.id + '_qty').value) || 0;
                const unit = document.getElementById(item.id + '_unit').value;
                const price = parseFloat(document.getElementById(item.id + '_price').value) || 0;
                const margin = parseFloat(document.getElementById(item.id + '_margin').value) || 0;
                const itemCost = qty * price;
                const itemFinal = itemCost * (1 + margin / 100);
                
                exportData.items[item.id] = {
                    qty: qty,
                    unit: unit,
                    price: price,
                    margin: margin,
                    cost: itemCost,
                    final: itemFinal
                };
                
                totalFinal += itemFinal;
            });
            
            exportData.totals.withoutVat = totalFinal;
            exportData.totals.vat = totalFinal * 0.21;
            exportData.totals.withVat = totalFinal * 1.21;
            
            // Uložit do localStorage
            localStorage.setItem('budgetData', JSON.stringify(exportData));
            
            // Otevřít hlavní nabídku
            window.open('nabidka-fve-asv-nova.html', '_blank');
            
            alert('Rozpočet byl exportován! Hlavní nabídka se otevře s aktualizovanými cenami.');
        }

        // Funkce pro uložení aktuálních hodnot do localStorage
        function saveBudgetState() {
            const savedData = {};
            budgetItems.forEach(item => {
                savedData[item.id] = {
                    qty: document.getElementById(item.id + '_qty').value,
                    unit: document.getElementById(item.id + '_unit').value,
                    price: document.getElementById(item.id + '_price').value,
                    margin: document.getElementById(item.id + '_margin').value
                };
            });
            localStorage.setItem('budgetState', JSON.stringify(savedData));
        }

        // Funkce pro načtení uložených hodnot
        function loadBudgetState() {
            const savedData = localStorage.getItem('budgetState');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    budgetItems.forEach(item => {
                        if (data[item.id]) {
                            if (data[item.id].qty) document.getElementById(item.id + '_qty').value = data[item.id].qty;
                            if (data[item.id].unit) document.getElementById(item.id + '_unit').value = data[item.id].unit;
                            if (data[item.id].price) document.getElementById(item.id + '_price').value = data[item.id].price;
                            if (data[item.id].margin) document.getElementById(item.id + '_margin').value = data[item.id].margin;
                        }
                    });
                    return true;
                } catch (error) {
                    console.error('Chyba při načítání uloženého stavu:', error);
                }
            }
            return false;
        }

        // Event listenery pro automatické přepočítávání
        document.addEventListener('DOMContentLoaded', function() {
            // Nejprve zkusit načíst uložený stav
            const stateLoaded = loadBudgetState();
            
            const inputs = document.querySelectorAll('.input-field');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    calculateBudget();
                    saveBudgetState(); // Automaticky uložit při každé změně
                });
                input.addEventListener('change', function() {
                    calculateBudget();
                    saveBudgetState(); // Automaticky uložit při každé změně
                });
            });
            
            // Počáteční výpočet
            calculateBudget();
            
            // Zobrazit notifikaci pokud byl načten uložený stav
            if (stateLoaded) {
                showNotification('✅ Načteny naposledy uložené hodnoty');
            }
        });
        
        // Funkce pro zobrazení notifikace
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                font-size: 14px;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 3000);
        }
    </script>
</body>
</html>